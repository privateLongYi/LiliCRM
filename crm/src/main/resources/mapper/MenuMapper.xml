<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.linxi.mapper.MenuMapper">

  <resultMap id="BaseResultMap" type="com.linxi.entity.Menu">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Sep 07 19:43:46 CST 2020.
    -->
    <id column="m_id" jdbcType="INTEGER" property="mId" />
    <result column="m_name" jdbcType="VARCHAR" property="mName" />
    <result column="m_url" jdbcType="VARCHAR" property="mUrl" />
    <result column="m_parent_id" jdbcType="INTEGER" property="mParentId" />
    <result column="m_type" jdbcType="VARCHAR" property="mType" />
    <result column="m_navgition" jdbcType="VARCHAR" property="mNavgition" />
  </resultMap>

  <!--根据菜单名称查询菜单-->
  <select id="queryMByMName" resultMap="BaseResultMap">
    SELECT * FROM menu
    <where>
      <if test="mName != null and mName != ''">
        m_name LIKE '%${mName}%'
      </if>
    </where>
    limit #{page}, #{limit}
  </select>

  <!--根据菜单名称查询菜单总条数-->
  <select id="getTotalByMName" resultType="Integer">
    SELECT COUNT(*) FROM menu
    <where>
      <if test="mName != null and mName != ''">
        m_name LIKE '%${mName}%'
      </if>
    </where>
  </select>

  <!--查询父级菜单-->
  <select id="queryMParent" resultMap="BaseResultMap">
    SELECT * FROM menu WHERE m_type = '父级'
  </select>

  <!--新增菜单-->
  <insert id="saveMenu">
    <if test="mType == '父级'">
      INSERT INTO menu(m_name, m_parent_id, m_type, m_navgition)
      VALUES (#{mName}, #{mParentId}, #{mType}, #{mNavgition})
    </if>
    <if test="mType == '子级'">
      INSERT INTO menu(m_name, m_url, m_parent_id, m_type, m_navgition)
      VALUES (#{mName}, #{mUrl}, #{mParentId}, #{mType}, #{mNavgition})
    </if>
  </insert>

  <!--根据编号删除菜单-->
  <delete id="delMByMId">
    DELETE FROM menu WHERE m_id = #{mId}
  </delete>

  <!--根据编号查询菜单-->
  <select id="queryMByMId" resultMap="BaseResultMap">
    SELECT * FROM menu WHERE m_id = #{mId}
  </select>

  <!--根据编号编辑菜单-->
  <update id="editMByMId">
    UPDATE menu SET m_name = #{mName}, m_url = #{mUrl}, m_parent_id = #{mParentId},
    m_type = #{mType}, m_navgition = #{mNavgition} WHERE m_id = #{mId}
  </update>

  <!--查询所有菜单-->
  <select id="queryMenuAll" resultMap="BaseResultMap">
    SELECT m.*, (SELECT COUNT(*) FROM menu me WHERE me.m_parent_id = m.m_id) AS childCount
     FROM menu m
  </select>

  <!--根据父级编号查询所有子级菜单-->
  <select id="queryMByMPId" resultMap="BaseResultMap">
    SELECT m.*, (SELECT COUNT(*) FROM menu me WHERE me.m_parent_id = m.m_id) AS childCount
     FROM menu m WHERE m.m_parent_id = #{pId}
  </select>

</mapper>