<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="UTF-8">
	<title>Title</title>
	<link rel="stylesheet" th:href="@{/layui/css/layui.css}"  media="all">
</head>
<body>

	<!--保存客户信息-->
	<input type="hidden" id="cId" th:value="${customer.cId}">
	<input type="hidden" id="cName" th:value="${customer.cName}">
	<input type="hidden" id="cSex" th:value="${customer.cSex}">
	<input type="hidden" id="cAge" th:value="${customer.cAge}">
	<input type="hidden" id="cTel" th:value="${customer.cTel}">
    <input type="hidden" id="cSource" th:value="${customer.cSource}">
	<input type="hidden" id="cPlaceTime" th:value="${customer.cPlaceTime}">
	<input type="hidden" id="cType" th:value="${customer.cType}">
	<input type="hidden" id="cProject" th:value="${customer.cProject}">
	<input type="hidden" id="cEarnest" th:value="${customer.cEarnest}">
	<input type="hidden" id="cRemark" th:value="${customer.cRemark}">

	<!--头部信息-->
	<div>
		<ul>
			<li style="font-size: 22px;">
				<i class="layui-icon" style="font-size: 40px; color: #1E9FFF; float: left;">&#xe66f;</i>
				<span name="cName" style="margin-top: 15px;"></span>
			</li>
		</ul>
	</div>
	<br />

	<!--客户信息缩略-->
	<div>
		<table class="layui-table" lay-skin="nob">
			<thead>
				<tr>
					<th>姓名</th>
					<th>电话</th>
					<th>来源</th>
					<th>下单时间</th>
					<th>状态</th>
				</tr>
				<tr>
					<td><span name="cName"></span></td>
					<td><span name="cTel"></span></td>
					<td><span name="cSource"></span></td>
					<td><span name="cPlaceTime"></span></td>
					<td><span name="cType"></span></td>
				</tr>
			</thead>
		</table>
	</div>

	<!--选项卡div-->
	<div class="layui-tab">

		<!--选项卡-->
		<ul class="layui-tab-title">
			<li class="layui-this">基本信息</li>
			<li>预约记录</li>
			<li>成交记录</li>
			<li>回访跟进</li>
			<li>操作记录</li>
		</ul>

		<div class="layui-tab-content" style="height: 100px;">

			<!--客户信息-->
			<div class="layui-tab-item layui-show">

				<!--row.0-->
				<div class="layui-show layui-row">
					<div class="layui-col-sm6">
						姓名：<span name="cName"></span>
					</div>
					<div class="layui-col-sm6">
						性别：<span name="cSex"></span>
					</div>
				</div>
				<br />
				<!--row.1-->
				<div class="layui-show layui-row">
					<div class="layui-col-sm6">
						客户年龄：<span name="cAge"></span>
					</div>
					<div class="layui-col-sm6">
						客户电话：<span name="cTel"></span>
					</div>
				</div><br />
				<!--row.2-->
				<div class="layui-show layui-row">
					<div class="layui-col-sm6">
						报名项目：<span name="cProject"></span>
					</div>
					<div class="layui-col-sm6">
						报名时间：<span name="cPlaceTime"></span>
					</div>
				</div><br />
				<!--row.3-->
				<div class="layui-row">
					<div class="layui-col-sm6">
						客户来源：<span name="cSource"></span>
					</div>
					<div class="layui-col-sm6">
						客户预交金额：<span name="cEarnest"></span>
					</div>
				</div><br />
				<!--row.4-->
				<div class="layui-row">
					<div class="layui-col-sm12">
						备注：<textarea name="cRemark" disabled="disabled" class="layui-textarea"
								  th:text="${customer.cRemark}"></textarea>
					</div>
				</div>

			</div>

			<!--预约记录-->
			<div class="layui-tab-item">

				<!--监听头工具栏-->
				<script type="text/html" id="toolbarDemo">
					<div class="layui-inline" lay-event="refresh"><i class="layui-icon layui-icon-refresh-1"></i></div>
					<div class="layui-inline" lay-event="edit"><i class="layui-icon layui-icon-edit"></i></div>
					<div class="layui-inline" lay-event="delete"><i class="layui-icon layui-icon-delete"></i></div>
				</script>

				<!--表格-->
				<table class="layui-hide" id="appointment" lay-filter="appointment"></table>

			</div>

			<!--成交记录-->
			<div class="layui-tab-item">
				<table class="layui-hide" id="success" lay-filter="success">

				</table>
			</div>

			<!--回访跟进-->
			<div class="layui-tab-item">
				<ul class="layui-timeline">
					<li class="layui-timeline-item">
						<i class="layui-icon layui-timeline-axis">&#xe63f;</i>
						<div class="layui-timeline-content layui-text">
							<h3 class="layui-timeline-title"><span>2020-8-31</span></h3>
							<p>
								客户感觉非常满意，觉得医生技术很好
							</p>
							<ul>
								<li>成交回访</li>
							</ul>
						</div>
					</li>
					<li class="layui-timeline-item">
						<i class="layui-icon layui-timeline-axis">&#xe63f;</i>
						<div class="layui-timeline-content layui-text">
							<h3 class="layui-timeline-title"><span>2020-7-31</span></h3>
							<p>
								客户 右下7左下6缺失 3700+3799 左下6需添加骨粉骨膜2500 总费用9999 已交全款
							</p>
							<ul>
								<li>成交门诊反馈</li>
							</ul>
						</div>
					</li>
					<li class="layui-timeline-item">
						<i class="layui-icon layui-timeline-axis">&#xe63f;</i>
						<div class="layui-timeline-content layui-text">
							<h3 class="layui-timeline-title"><span>2020-5-31</span></h3>
							<p>
								客户要求转诊 4月15号 雅美鑫 客户已经种植2颗 牙位22 34 拔牙300+骨粉1000+骨膜1000
							</p>
							<ul>
								<li>未成交回访</li>
							</ul>
						</div>
					</li>

					<li class="layui-timeline-item">
						<i class="layui-icon layui-timeline-axis">&#xe63f;</i>
						<div class="layui-timeline-content layui-text">
							<h3 class="layui-timeline-title"><span>2020-4-6</span></h3>
							<p>
								客户尺度面诊口腔反馈：左上二松动二度，伸长，牙神经正常。<br />
								拍片检查后，咬合问题严重，建议先做矫正，后期若有问题再行拔除。<br />
								种植修复。今天拍片取模型约定下次确定具体矫正方案
							</p>
							<ul>
								<li>未成交门诊反馈</li>
							</ul>
						</div>
					</li>
				</ul>
			</div>

			<!--操作记录-->
			<div class="layui-tab-item">
				<ul class="layui-timeline">
					<li class="layui-timeline-item">
						<i class="layui-icon layui-timeline-axis">&#xe63f;</i>
						<div class="layui-timeline-content layui-text">
							<h3 class="layui-timeline-title"><span>2020-3-31</span>&nbsp;||&nbsp;<span>Admin</span></h3>
							<p>
								<a>Admin</a>添加了客户
							</p>
						</div>
					</li>
					<li class="layui-timeline-item">
						<i class="layui-icon layui-timeline-axis">&#xe63f;</i>
						<div class="layui-timeline-content layui-text">
							<h3 class="layui-timeline-title"><span>2020-4-1</span>&nbsp;||&nbsp;<span>罗洋</span></h3>
							<p>
								<a>罗洋</a>联系了客户
							</p>
						</div>
					</li>
					<li class="layui-timeline-item">
						<i class="layui-icon layui-timeline-axis">&#xe63f;</i>
						<div class="layui-timeline-content layui-text">
							<h3 class="layui-timeline-title"><span>2020-4-1</span>&nbsp;||&nbsp;<span>罗洋</span></h3>
							<p>
								<a>罗洋</a>预约了客户
							</p>
						</div>
					</li>
					<li class="layui-timeline-item">
						<i class="layui-icon layui-timeline-axis">&#xe63f;</i>
						<div class="layui-timeline-content layui-text">
							<h3 class="layui-timeline-title"><span>2020-4-1</span>&nbsp;||&nbsp;<span>罗洋</span></h3>
							<p>
								<a>罗洋</a>添加了未成交反馈，客户到店未成交
							</p>
						</div>
					</li>
					<li class="layui-timeline-item">
						<i class="layui-icon layui-timeline-axis">&#xe63f;</i>
						<div class="layui-timeline-content layui-text">
							<h3 class="layui-timeline-title"><span>2020-4-1</span>&nbsp;||&nbsp;<span>罗洋</span></h3>
							<p>
								<a>罗洋</a>进行了未成交回访
							</p>
						</div>
					</li>
					<li class="layui-timeline-item">
						<i class="layui-icon layui-timeline-axis">&#xe63f;</i>
						<div class="layui-timeline-content layui-text">
							<h3 class="layui-timeline-title"><span>2020-4-1</span>&nbsp;||&nbsp;<span>罗洋</span></h3>
							<p>
								<a>罗洋</a>转诊了客户
							</p>
						</div>
					</li>
					<li class="layui-timeline-item">
						<i class="layui-icon layui-timeline-axis">&#xe63f;</i>
						<div class="layui-timeline-content layui-text">
							<h3 class="layui-timeline-title"><span>2020-4-1</span>&nbsp;||&nbsp;<span>罗洋</span></h3>
							<p>
								<a>罗洋</a>添加了成交反馈
							</p>
						</div>
					</li>
					<li class="layui-timeline-item">
						<i class="layui-icon layui-timeline-axis">&#xe63f;</i>
						<div class="layui-timeline-content layui-text">
							<h3 class="layui-timeline-title"><span>2020-4-1</span>&nbsp;||&nbsp;<span>罗洋</span></h3>
							<p>
								<a>罗洋</a>进行了成交回访
							</p>
						</div>
					</li>
				</ul>
			</div>

		</div>

	</div>

	<script th:src="@{/layui/layui.js}"></script>

	<script>
		//加载form、laydate
		layui.use(['element', 'table'], function() {

			var element = layui.element
				,$ = layui.jquery
				,layer = layui.layer
				,table = layui.table;

			//获得客户信息
			var cId = $("#cId").val();
			var cName = $("#cName").val();
			var cSex = $("#cSex").val();
			var cAge = $("#cAge").val();
			var cTel = $("#cTel").val();
			var cProject = $("#cProject").val();
			//改变时间格式 yyyy-MM-dd HH:mm:ss.0 改为 yyyy-MM-dd HH:mm:ss
			var time = $("#cPlaceTime").val();
			var cPlaceTime = time.substring(0, time.length - 2);
			var cSource = $("#cSource").val();
			var cEarnest = $("#cEarnest").val();
			var cRemark = $("#cRemark").val();
			var cType = $("#cType").val();

			//赋值
			var cNameList = $("[name=cName]");
			for(var i = 0; i < cNameList.length; i++){
				cNameList[i].innerText = cName;
			}
			var cTelList = $("[name=cTel]");
			for(var i = 0; i < cTelList.length; i++){
				cTelList[i].innerText = cTel;
			}
			var cSourceList = $("[name=cSource]");
			for(var i = 0; i < cSourceList.length; i++){
				cSourceList[i].innerText = cSource;
			}
			var cPlaceTimeList = $("[name=cPlaceTime]");
			for(var i = 0; i < cPlaceTimeList.length; i++){
				cPlaceTimeList[i].innerText = cPlaceTime;
			}
			var cTypeList = $("[name=cType]");
			for(var i = 0; i < cTypeList.length; i++){
				cTypeList[i].innerText = cType;
			}
			$("[name=cSex]")[0].innerText = cSex;
			$("[name=cAge]")[0].innerText = cAge;
			$("[name=cProject]")[0].innerText = cProject;
			$("[name=cEarnest]")[0].innerText = cEarnest;
			$("[name=cRemark]")[0].innerText = cRemark;

            //表格重载
            function tableReload(){
                table.reload('appointment', {
                    url: '/appointment/queryAByACId?aCId='+cId
                });
            }

			//预约记录
			table.render({
				elem: '#appointment'
				,url: '/appointment/queryAByACId?aCId='+cId
				,id: 'appointment' //表格id
				,page: true //开启分页
				,limit: 5 //每页显示条数
				,limits: [5, 10, 20, 50, 100] //自定义可选每页显示条数
                ,toolbar: '#toolbarDemo' //编辑、删除工具栏
				,cols: [
					[
						{type: 'checkbox', fixed: 'left'}
						,{field:'aId', title: '编号'}
						,{field:'hospital', title: '预约门诊'}
						,{field:'aTime', title: '预约时间', sort: true}
						,{field:'aType', title: '预约类型'}
					]
				]
			});

			//预约记录监听头工具栏事件
			table.on('toolbar(appointment)', function(obj){
				var checkStatus = table.checkStatus(obj.config.id)
					,data = checkStatus.data; //获取选中的数据
				switch(obj.event){
					case 'refresh':
					    tableReload();
					    break;
					case 'edit':
						if(data.length === 0){
							layer.msg('请选择一行');
						} else if(data.length > 1){
							layer.msg('只能同时编辑一个');
						} else {
                            //弹出编辑页面
                            var edit = layer.open({
                                type: 2, //层类型，iframe
                                title: '编辑客户预约',
                                content: ['/appointment/queryAByAId?aId=' + checkStatus.data[0].aId],
                                area: ['500px', '450px'],
                                resize: false,
                                btn: '确定',
                                btn1: function (index, layero) {
                                    var body = layer.getChildFrame('body', index);
                                    //获取值
                                    var aCId = $(body).find("#aCId").val();
                                    var aTime = $(body).find("#aTime").val();
                                    var aHId = $(body).find("#aHId").val();
                                    var aTypeId = $(body).find("#aTypeId").val();

                                    if (aTime != '') {
                                        $.post("/appointment/editAByAId?aId=" + checkStatus.data[0].aId,
											{aCId:aCId, aTime: aTime, aHId:aHId, aTypeId:aTypeId},
                                            function (obj) {
                                                if (obj.code == 0) {
                                                    layer.msg(obj.msg, {time: 500}, function () {
                                                        layer.close(edit);
                                                        tableReload();
                                                    });
                                                } else {
                                                    layer.msg(obj.msg)
                                                }
                                            }
                                        );
                                    } else {
                                        layer.msg('请输入预约时间');
                                    }
                                },
                                cancel: function(index, layero){
                                    layer.close(index);
                                }
                            });
						}
						break;
					case 'delete':
						if(data.length === 0){
							layer.msg('请选择一行');
						} else {
							layer.confirm('真的删除行么', function(){
                                $.get("/appointment/delAByAId?aId=" + checkStatus.data[0].aId, function(obj){
                                    if (obj.code == 0) {
                                        layer.msg(obj.msg, {time: 500}, function () {
                                            tableReload();
                                        });
                                    } else {
                                        layer.msg(obj.msg)
                                    }
                                });
							});
						}
						break;
				};
			});

			//成交记录
			table.render({
				elem: '#test',
				url: 't.json', //json文件地址
				toolbar: '#toolbarDemo', //开启头部工具栏，并为其绑定左侧模板
				defaultToolbar: ['filter', 'exports', 'print', { //自定义头部工具栏右侧图标。如无需自定义，去除该参数即可
					title: '提示',
					layEvent: 'LAYTABLE_TIPS',
					icon: 'layui-icon-tips'
				}],
				title: '成交信息表',
				cols: [
					[{
						type: 'checkbox',
						fixed: 'left'
					} //头部工具栏
						, {
						field: 's_id',
						title: 'ID',
						event: 'collapse',
						width: 80,
						unresize: true,
						sort: true,
						templet: function(d) {
							return '<div style="position: relative;\n' + '    padding: 0 10px 0 20px;">' + d.s_id +
								'<i	style="left: 0px;" lay-tips="展开" class="layui-icon layui-colla-icon layui-icon-right"></i></div>'
						}
					} //客户id
						, {
						field: 's_c_name',
						title: '用户名',
						width: 90,
						edit: 'text'
					} //客户姓名
						, {
						field: 's_c_tel',
						title: '电话',
						width: 150,
						edit: 'text',
						sort: true
					} //客户电话
						, {
						field: 's_message',
						title: '成交信息',
						width: 100
					} //成交信息
						, {
						field: 's_sum',
						title: '成交金额',
						width: 100
					} //成交金额
						, {
						field: 's_paysum',
						title: '已交金额',
						width: 100,
						sort: true
					} //已交金额
						, {
						field: 's_remake',
						title: '成交备注',
						width: 250
					} //成交备注
						, {
						field: 's_time',
						title: '成交时间',
						width: 200
					} //成交时间
						, {
						fixed: 'right',
						title: '工具',
						width: 150,
						align: 'center',
						toolbar: '#barDemo'
					} //侧边功能栏
					]
				],
				page: true
			});

			//头工具栏事件
			table.on('toolbar(test)', function(obj) {
				var checkStatus = table.checkStatus(obj.config.id);
				switch (obj.event) {
					case 'getCheckData':
						var data = checkStatus.data;
						layer.alert(JSON.stringify(data));
						break;
					case 'getCheckLength':
						var data = checkStatus.data;
						layer.msg('选中了：' + data.length + ' 个');
						break;
					case 'isAll':
						layer.msg(checkStatus.isAll ? '全选' : '未全选');
						break;

					//自定义头工具栏右侧图标 - 提示
					case 'LAYTABLE_TIPS':
						layer.alert('这是工具栏右侧自定义的一个图标按钮');
						break;
				};
			});

			//监听行工具事件
			table.on('tool(test)', function(obj) {
				var data = obj.data;
				//console.log(obj)
				if (obj.event == 'collapse') {
					var trObj = layui.$(this).parent('tr'); //当前行
					var accordion = true //开启手风琴，那么在进行折叠操作时，始终只会展现当前展开的表格。
					var content = '<table></table>' //内容
				}
				if (obj.event === 'del') {
					layer.confirm('真的删除行么', function(index) {
						obj.del();
						layer.close(index);
					});
				} else if (obj.event === 'edit') {
					layer.prompt({
						formType: 2,
						value: data.email
					}, function(value, index) {
						obj.update({
							email: value
						});
						layer.close(index);
					});
				}

			});

		});
	</script>

</body>
</html>