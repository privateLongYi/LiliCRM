<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <title>首页</title>
    <link rel="stylesheet" type="text/css" th:href="@{/layui/css/layui.css}" />
</head>
<body class="layui-layout-body">
<div class="layui-layout layui-layout-admin">

    <!--头部固定区域-->
    <div class="layui-header">
        <div class="layui-logo">LiliCRM</div>
        <!-- 头部区域（可配合layui已有的水平导航） -->
        <ul class="layui-nav layui-layout-right">
            <li class="layui-nav-item">
                <input type="hidden" id="uId" th:value="${user.getuId()}" >
                <input type="hidden" id="uName" th:value="${user.getuName()}" >
                <input type="hidden" id="uRoleId" th:value="${user.getuRoleId()}" >
                <input type="hidden" id="rName" th:value="${user.getrName()}" >
                <a href="javascript:;">
                    <img th:src="@{/images/head.jpg}" class="layui-nav-img">
                    <span id="username" th:text="${user.getuName()}"></span>
                </a>
                <dl class="layui-nav-child">
                    <dd><a href="">修改密码</a></dd>
                </dl>
            </li>
            <li class="layui-nav-item"><a th:href="@{/logout}">注销</a></li>
        </ul>
    </div>

    <!--左侧导航栏-->
    <div class="layui-side layui-bg-black">
        <div class="layui-side-scroll">
            <!-- 左侧导航区域（可配合layui已有的垂直导航） -->
            <ul class="layui-nav layui-nav-tree" lay-filter="test" id="nav">
                <li class="layui-nav-item layui-nav-itemed">
                    <a href="javascript:void(0);" id="workbench" class="skip">工作台</a>
                </li>
            </ul>
        </div>
    </div>

    <!-- 内容主体区域 -->
    <div class="layui-body" style="background-color: #f5f5f5; bottom: 0px;">
        <!--iframe框架-->
        <iframe id="frame" name="frame" src="workbench" frameborder="0"
                scrolling="no" style="width: 100%;height: 1200px;"></iframe>
    </div>

</div>
<script src="//cdn.bootcdn.net/ajax/libs/layui/2.4.3/layui.all.min.js"></script>
<!--<script th:src="@{layui/layui.all.js}"></script>-->

<script>

    layui.use('element', function() {
        var $ = layui.jquery;
        var element = layui.element; //Tab的切换功能，切换事件监听等，需要依赖element模块

        //获取用户编号和用户名
        var uId = $("#uId").val();
        var uName = $("#uName").val();
        var uRoleId = $("#uRoleId").val();
        var rName = $("#rName").val();

        //把用户编号和用户名存到sessionStorage
        sessionStorage.setItem('uId', uId);
        sessionStorage.setItem('uName', uName);
        sessionStorage.setItem('uRoleId', uRoleId);
        sessionStorage.setItem('rName', rName);

        //获取菜单列表
        $.get("/authority/queryRMByRId?rId="+uRoleId, function (obj) {
            //定义内容
            var html = "";
            var parent = obj.data;
            var child = obj.data;
            for(index in parent){
                if(parent[index].mParentId == 0){
                    html += "<li class='layui-nav-item'>" +
                        "       <a class='' href='javascript:;'>"+parent[index].mName+"</a>" +
                        "       <dl class='layui-nav-child'>";
                    for(i in child){
                        if(child[i].mParentId == parent[index].rmMId){
                            html += "<dd>" +
                                "   <a href='javascript:;' id='"+child[i].mUrl+"' class='skip'>"+child[i].mName+"</a>" +
                                "</dd>"
                        }
                    }
                    html += "   </dl>" +
                        "</li>";
                }
            }

            //给导航条赋值
            $("#nav").append(html);
            //重新渲染元素
            element.init();

            //绑定跳转事件
            $(".skip").on("click", function () {
                //设置跳转路径
                $("#frame").attr("src", this.id);
            })

        });
/*

        function setIframeHeight(iframe) {
            if (iframe) {
                var iframeWin = iframe.contentWindow || iframe.contentDocument.parentWindow;
                if (iframeWin.document.body) {
                    iframe.height = iframeWin.document.documentElement.scrollHeight || iframeWin.document.body.scrollHeight;
                }
            }
        };

        window.onload = function () {
            setIframeHeight(document.getElementById('frame'));
        };
*/

    });
</script>
</body>
</html>